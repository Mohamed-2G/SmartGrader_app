"""
translations.py - Multi-language support for SmartGrader
"""

# SmartGrader - Internationalization System
# Supports: English, French, Arabic, Turkish

import json
from flask import session, request

# Available languages
LANGUAGES = {
    'en': 'English',
    'fr': 'Français',
    'ar': 'العربية',
    'tr': 'Türkçe'
}

# Translation data
TRANSLATIONS = {
    'en': {
        # Navigation
        'nav_home': 'Home',
        'nav_dashboard': 'Dashboard',
        'nav_exams': 'Exams',
        'nav_submissions': 'Submissions',
        'nav_logout': 'Logout',
        'nav_login': 'Login',
        'nav_register': 'Register',
        'instructor_dashboard': 'Instructor Dashboard',
        'student_dashboard': 'Student Dashboard',
        'my_exams': 'My Exams',
        'create_exam': 'Create Exam',
        'available_exams': 'Available Exams',
        'my_submissions': 'My Submissions',
        'messages': 'Messages',
        'file_upload': 'File Upload',
        'logout': 'Logout',
        'dashboard': 'Dashboard',
        'users': 'Users',
        'system': 'System',
        
        # Authentication
        'login_title': 'Login to SmartGrader',
        'login_email': 'Email',
        'login_password': 'Password',
        'login_submit': 'Login',
        'login_error': 'Invalid email or password',
        'register_title': 'Create Account',
        'register_name': 'Full Name',
        'register_email': 'Email',
        'register_password': 'Password',
        'register_confirm_password': 'Confirm Password',
        'register_role': 'Role',
        'register_instructor': 'Instructor',
        'register_student': 'Student',
        'register_submit': 'Register',
        'register_success': 'Account created successfully!',
        'register_error': 'Registration failed. Please try again.',
        
        # Login and Registration UI
        'signup': 'Sign Up',
        'incase_forgot_password': 'In case you forgot your password',
        'click_here_to_reset': 'Click here to reset',
        'create_your_account': 'Create Your Account',
        'full_name_label': 'Full Name',
        'username_label': 'Username',
        'email_address_label': 'Email Address',
        'password_label': 'Password',
        'confirm_password_label': 'Confirm Password',
        'preferred_language_label': 'Preferred Language',
        'minimum_characters': 'Minimum 8 characters',
        'terms_agreement_text': 'I agree to the terms and conditions',
        'create_account_button': 'Create Account',
        'error_changing_language': 'Error changing language: ',
        'error_changing_language_generic': 'Error changing language. Please try again.',
        'password_mismatch_validation': 'Passwords do not match',
        'registration_success_alert': 'Registration successful! Please check your email.',
        'registration_failed_alert': 'Registration failed: ',
        'registration_failed_generic': 'Registration failed. Please try again.',
        
        # Password Reset
        'password_reset': 'Password Reset',
        'password_reset_subtitle': 'Reset your password securely',
        'password_reset_description': 'Choose your preferred method to reset your password',
        'forgot_password': 'Forgot Password',
        'email_verification': 'Email Verification',
        'moderator_request': 'Moderator Request',
        'email_address': 'Email Address',
        'email_verification_help': 'Enter your email address to receive a verification code',
        'send_verification_code': 'Send Verification Code',
        'username': 'Username',
        'reset_reason': 'Reason for Reset',
        'reset_reason_placeholder': 'Please explain why you need a password reset...',
        'request_moderator_help': 'Request Moderator Help',
        'back_to_login': 'Back to Login',
        'code_sent_to': 'Verification code sent to',
        'check_spam_folder': 'Please check your spam folder if you don\'t see it',
        'verification_code': 'Verification Code',
        'enter_6_digit_code': 'Enter the 6-digit code sent to your email',
        'verify_code': 'Verify Code',
        'didnt_receive_code': 'Didn\'t receive the code?',
        'resend_code': 'Resend Code',
        'back_to_reset': 'Back to Reset',
        
        # Dashboard
        'dashboard_welcome': 'Welcome to SmartGrader',
        'dashboard_welcome_subtitle': 'Your AI-powered grading assistant',
        'dashboard_recent_exams': 'Recent Exams',
        'dashboard_recent_submissions': 'Recent Submissions',
        'dashboard_view_all': 'View All',
        'dashboard_no_exams': 'No exams uploaded yet',
        'dashboard_no_submissions': 'No submissions yet',
        'dashboard_total_exams': 'Total Exams',
        'dashboard_total_submissions': 'Total Submissions',
        'dashboard_avg_score': 'Average Score',
        'totalsubmissions': 'Total Submissions',
        'graded': 'Graded',
        'pending': 'Pending',
        'averagescore': 'Average Score',
        'quickactions': 'Quick Actions',
        'viewavailableexams': 'View Available Exams',
        'mysubmissions': 'My Submissions',
        'viewresults': 'View Results',
        'availableexams': 'Available Exams',
        'viewall': 'View All',
        'instructordashboard': 'Instructor Dashboard',
        'createnewexam': 'Create New Exam',
        'totalexams': 'Total Exams',
        'pendinggrading': 'Pending Grading',
        'quickactions': 'Quick Actions',
        'uploadnewexam': 'Upload New Exam',
        'viewallexams': 'View All Exams',
        'viewallsubmissions': 'View All Submissions',
        'testaigrading': 'Test AI Grading',
        'recentexams': 'Recent Exams',
        'examprocessed': 'Processed',
        'examquestions': 'Questions',
        'exampoints': 'Points',
        'noexamsuploaded': 'No exams uploaded yet',
        'uploadfirstexam': 'Upload First Exam',
        'recentsubmissions': 'Recent Submissions',
        'nosubmissions': 'No submissions yet',
        'nosubmissionsmessage': 'Students will appear here once they submit exams',
        
        # Exam Management
        'exam_upload_title': 'Upload New Exam',
        'exam_upload_file': 'Upload PDF/File',
        'exam_upload_manual': 'Create Questions Manually',
        'exam_upload_submit': 'Upload Exam',
        'exam_upload_success': 'Exam uploaded successfully!',
        'exam_upload_error': 'Failed to upload exam',
        'exam_list_title': 'All Exams',
        'exam_delete': 'Delete Exam',
        'exam_delete_confirm': 'Are you sure you want to delete this exam?',
        'exam_delete_success': 'Exam deleted successfully',
        'exam_delete_error': 'Cannot delete exam with submissions',
        'exam_view_submissions': 'View Submissions',
        'exam_add_questions': 'Add Questions Manually',
        'exam_questions_detected': 'Questions detected',
        'exam_processing_failed': 'Processing failed',
        
        # Question Management
        'question_text': 'Question Text',
        'question_points': 'Points',
        'question_type': 'Question Type',
        'question_add': 'Add Question',
        'question_remove': 'Remove',
        'question_reorder': 'Reorder',
        'question_save': 'Save Questions',
        'question_save_success': 'Questions saved successfully',
        
        # Submission Management
        'submission_list_title': 'Submissions',
        'submission_student': 'Student',
        'submission_date': 'Date',
        'submission_score': 'Score',
        'submission_status': 'Status',
        'submission_graded': 'Graded',
        'submission_pending': 'Pending',
        'submission_view': 'View',
        'submission_delete': 'Delete',
        'submission_delete_confirm': 'Delete this submission?',
        'submission_reevaluate': 'Re-evaluate',
        'submission_reevaluate_all': 'Re-evaluate All',
        'submission_delete_all': 'Delete All',
        'submission_delete_all_confirm': 'Delete all submissions?',
        
        # Grading
        'grading_title': 'Grading Results',
        'grading_question': 'Question',
        'grading_answer': 'Student Answer',
        'grading_score': 'Score',
        'grading_feedback': 'Feedback',
        'grading_total': 'Total Score',
        'grading_ai_failed': 'AI grading failed',
        'grading_basic_score': 'Basic Grade',
        'grading_processing': 'Processing...',
        'grading_completed': 'Grading completed!',
        
        # Student Interface
        'student_take_exam': 'Take Exam',
        'student_submit_exam': 'Submit Exam',
        'student_answer_file': 'Complete Answer File (Optional)',
        'student_answer_file_help': 'Upload a file with all your answers for better detection',
        'student_submit_success': 'Exam submitted successfully!',
        'student_submit_error': 'Failed to submit exam',
        'student_exam_completed': 'Exam completed',
        'student_view_results': 'View Results',
        'back_to_dashboard': 'Back to Dashboard',
        'exam_questions_header': 'Exam Questions',
        'question_label': 'Question',
        'points_label': 'points',
        'your_answer_label': 'Your Answer',
        'type_answer_placeholder': 'Type your answer here...',
        'upload_file_optional': 'Upload File (Optional):',
        'upload_file_help': 'Upload PDF, image, or document files. AI will analyze handwritten work and images.',
        'complete_answer_file_optional': 'Complete Answer File (Optional)',
        'upload_complete_answer_label': 'Upload Complete Answer File:',
        'save_progress': 'Save Progress',
        'no_questions_available': 'No Questions Available',
        'no_questions_yet': "This exam doesn't have any questions yet.",
        'exam_information': 'Exam Information',
        'exam_label': 'Exam',
        'general_label': 'General',
        'questions_label': 'Questions',
        'total_points_label': 'Total Points',
        'time_limit_label': 'Time Limit',
        'no_time_limit': 'No time limit',
        'progress_label': 'Progress',
        'confirm_submission': 'Confirm Submission',
        'confirm_submit_exam': 'Are you sure you want to submit this exam?',
        'submit_final_notice': 'Once submitted, you cannot change your answers.',
        
        # Common UI Elements
        'btn_save': 'Save',
        'btn_cancel': 'Cancel',
        'btn_edit': 'Edit',
        'btn_delete': 'Delete',
        'btn_view': 'View',
        'btn_back': 'Back',
        'btn_next': 'Next',
        'btn_previous': 'Previous',
        'btn_submit': 'Submit',
        'btn_upload': 'Upload',
        'btn_download': 'Download',
        'btn_close': 'Close',
        
        # Messages
        'msg_success': 'Operation completed successfully',
        'msg_error': 'An error occurred',
        'msg_warning': 'Warning',
        'msg_info': 'Information',
        'msg_confirm': 'Are you sure?',
        'msg_loading': 'Loading...',
        'msg_no_data': 'No data available',
        'msg_users': 'Users',
        'msg_system': 'System',
        'msg_messages': 'Messages',
        
        # File Upload
        'file_upload_drag': 'Drag and drop files here',
        'file_upload_click': 'or click to browse',
        'file_upload_supported': 'Supported formats: PDF, DOC, DOCX, TXT, Images',
        'file_upload_error': 'Invalid file format',
        'file_upload_size_error': 'File too large',
        
        # Language
        'language': 'Language',
        'language_en': 'English',
        'language_fr': 'Français',
        'language_ar': 'العربية',
        'language_tr': 'Türkçe',
        
        # Footer
        'footer_copyright': '© 2024 SmartGrader. All rights reserved.',
        'footer_version': 'Version 1.0',
        'mark_all_as_read': 'Mark All as Read',
        'new_message': 'New',
        # Messaging UI
        'compose_message_title': 'Compose Message',
        'back_to_messages': 'Back to Messages',
        'to_label': 'To',
        'from_label': 'From',
        'subject_label': 'Subject',
        'message_label': 'Message',
        'enter_subject_placeholder': 'Enter subject...',
        'type_message_placeholder': 'Type your message here...',
        'select_recipient_placeholder': 'Select recipient...',
        'select_recipient_help': 'Select a user to send your message to.',
        'send_message_button': 'Send Message',
        'inbox_tab': 'Inbox',
        'sent_tab': 'Sent',
        'no_subject': 'No Subject',
        'no_messages_in_inbox': 'No messages in inbox',
        'no_messages_in_inbox_desc': "You haven't received any messages yet.",
        'no_sent_messages': 'No sent messages',
        'no_sent_messages_desc': "You haven't sent any messages yet.",
        'view_message_title': 'View Message',
        'attachment_label': 'Attachment',
        'read_status': 'Read',
        'delivered_status': 'Delivered',
        'reply_button': 'Reply',
        
        # Email Verification
        'verification_email_subject': 'SmartGrader - Password Reset Verification',
        'verification_email_greeting': 'Hello,',
        'verification_email_body': 'You have requested to reset your password for your SmartGrader account. Please use the verification code below to complete the password reset process.',
        'verification_email_expiry': 'This code will expire in 15 minutes.',
        'verification_email_link_text': 'Password Reset Link',
        'verification_email_footer': 'If you did not request this password reset, please ignore this email. Your account security is important to us.',
        'verification_code_sent': 'Verification code sent to your email successfully!',
        'email_send_error': 'Failed to send verification email. Please try again.',
        'invalid_or_expired_code': 'Invalid or expired verification code.',
        'code_resent': 'Verification code has been resent to your email.',
        'password_updated_successfully': 'Password updated successfully! You can now log in with your new password.',
        'email_not_found': 'Email address not found in our system.',
        'invalid_request': 'Invalid request.',
        'invalid_or_expired_token': 'Invalid or expired reset token.',
        'password_too_short': 'Password must be at least 8 characters long.',
        'passwords_not_match': 'Passwords do not match.',
        'username_email_mismatch': 'Username does not match the provided email address.',
        'moderator_request_sent': 'Password reset request sent to moderators successfully.',
        'moderator_request_error': 'Failed to send moderator request. Please try again.',
        'password_reset_request': 'Password Reset Request',
        'password_reset_request_body': 'A user has requested a password reset through moderator assistance.',
        'user_details': 'User Details',
        'moderator_action_required': 'Please assist this user with their password reset request.',
        
        # Change Password
        'new_password': 'New Password',
        'new_password_subtitle': 'Set Your New Password',
        'new_password_description': 'Enter a strong password to secure your account',
        'set_new_password': 'Set New Password',
        'account_verified': 'Account verified for',
        'password_requirements': 'Password must be at least 8 characters long',
        'confirm_new_password': 'Confirm New Password',
        'update_password': 'Update Password',
        
        # Login/Logout Messages
        'login_successful': 'Login successful!',
        'logout_successful': 'Logout successful!',
        'invalid_credentials': 'Invalid email or password',
        
        # Security Question System
        'security_question': 'Security Question',
        'security_answer': 'Security Answer',
        'select_security_question': 'Select a Security Question',
        'enter_security_answer': 'Enter Your Answer',
        'security_question_required': 'Please select a security question and provide an answer',
        'security_answer_required': 'Please provide an answer to your security question',
        'security_question_incorrect': 'Incorrect security answer. Please try again.',
        'security_question_success': 'Security answer verified successfully!',
        'password_reset_via_security_question': 'Password Reset via Security Question',
        'answer_security_question': 'Answer Your Security Question',
        'security_question_help': 'This will be used to reset your password if you forget it',
        
        # Additional Security Question Keys
        'email_not_found': 'Email not found',
        'invalid_request': 'Invalid request',
        'password_updated_successfully': 'Password updated successfully!',
        'passwords_not_match': 'Passwords do not match'
    },
    
    'fr': {
        # Navigation
        'nav_home': 'Accueil',
        'nav_dashboard': 'Tableau de bord',
        'nav_exams': 'Examens',
        'nav_submissions': 'Soumissions',
        'nav_logout': 'Déconnexion',
        'nav_login': 'Connexion',
        'nav_register': 'S\'inscrire',
        'instructor_dashboard': 'Tableau de bord Instructeur',
        'student_dashboard': 'Tableau de bord Étudiant',
        'my_exams': 'Mes Examens',
        'create_exam': 'Créer un Examen',
        'available_exams': 'Examens Disponibles',
        'my_submissions': 'Mes Soumissions',
        'messages': 'Messages',
        'file_upload': 'Téléchargement de Fichier',
        'logout': 'Déconnexion',
        'dashboard': 'Tableau de bord',
        'users': 'Utilisateurs',
        'system': 'Système',
        
        # Authentication
        'login_title': 'Connexion à SmartGrader',
        'login_email': 'Email',
        'login_password': 'Mot de passe',
        'login_submit': 'Se connecter',
        'login_error': 'Email ou mot de passe invalide',
        'register_title': 'Créer un compte',
        'register_name': 'Nom complet',
        'register_email': 'Email',
        'register_password': 'Mot de passe',
        'register_confirm_password': 'Confirmer le mot de passe',
        'register_role': 'Rôle',
        'register_instructor': 'Instructeur',
        'register_student': 'Étudiant',
        'register_submit': 'S\'inscrire',
        'register_success': 'Compte créé avec succès !',
        'register_error': 'Échec de l\'inscription. Veuillez réessayer.',
        
        # Login and Registration UI
        'signup': 'S\'inscrire',
        'incase_forgot_password': 'Au cas où vous auriez oublié votre mot de passe',
        'click_here_to_reset': 'Cliquez ici pour réinitialiser',
        'create_your_account': 'Créer votre compte',
        'full_name_label': 'Nom complet',
        'username_label': 'Nom d\'utilisateur',
        'email_address_label': 'Adresse e-mail',
        'password_label': 'Mot de passe',
        'confirm_password_label': 'Confirmer le mot de passe',
        'preferred_language_label': 'Langue préférée',
        'minimum_characters': 'Minimum 8 caractères',
        'terms_agreement_text': 'J\'accepte les termes et conditions',
        'create_account_button': 'Créer un compte',
        'error_changing_language': 'Erreur lors du changement de langue : ',
        'error_changing_language_generic': 'Erreur lors du changement de langue. Veuillez réessayer.',
        'password_mismatch_validation': 'Les mots de passe ne correspondent pas',
        'registration_success_alert': 'Inscription réussie ! Veuillez vérifier votre e-mail.',
        'registration_failed_alert': 'Échec de l\'inscription : ',
        'registration_failed_generic': 'Échec de l\'inscription. Veuillez réessayer.',
        
        # Password Reset
        'password_reset': 'Réinitialisation du mot de passe',
        'password_reset_subtitle': 'Réinitialisez votre mot de passe en toute sécurité',
        'password_reset_description': 'Choisissez votre méthode préférée pour réinitialiser votre mot de passe',
        'forgot_password': 'Mot de passe oublié',
        'email_verification': 'Vérification par e-mail',
        'moderator_request': 'Demande de modérateur',
        'email_address': 'Adresse e-mail',
        'email_verification_help': 'Entrez votre adresse e-mail pour recevoir un code de vérification',
        'send_verification_code': 'Envoyer le code de vérification',
        'username': 'Nom d\'utilisateur',
        'reset_reason': 'Raison de la réinitialisation',
        'reset_reason_placeholder': 'Veuillez expliquer pourquoi vous avez besoin d\'une réinitialisation de mot de passe...',
        'request_moderator_help': 'Demander l\'aide d\'un modérateur',
        'back_to_login': 'Retour à la connexion',
        'code_sent_to': 'Code de vérification envoyé à',
        'check_spam_folder': 'Veuillez vérifier votre dossier spam si vous ne le voyez pas',
        'verification_code': 'Code de vérification',
        'enter_6_digit_code': 'Entrez le code à 6 chiffres envoyé à votre e-mail',
        'verify_code': 'Vérifier le code',
        'didnt_receive_code': 'Vous n\'avez pas reçu le code ?',
        'resend_code': 'Renvoyer le code',
        'back_to_reset': 'Retour à la réinitialisation',
        
        # Dashboard
        'dashboard_welcome': 'Bienvenue sur SmartGrader',
        'dashboard_welcome_subtitle': 'Votre assistant de notation alimenté par l\'IA',
        'dashboard_recent_exams': 'Examens récents',
        'dashboard_recent_submissions': 'Soumissions récentes',
        'dashboard_view_all': 'Voir tout',
        'dashboard_no_exams': 'Aucun examen téléchargé',
        'dashboard_no_submissions': 'Aucune soumission',
        'dashboard_total_exams': 'Total des examens',
        'dashboard_total_submissions': 'Total des soumissions',
        'dashboard_avg_score': 'Score moyen',
        'totalsubmissions': 'Total des soumissions',
        'graded': 'Noté',
        'pending': 'En attente',
        'averagescore': 'Score moyen',
        'quickactions': 'Actions rapides',
        'viewavailableexams': 'Voir les examens disponibles',
        'mysubmissions': 'Mes soumissions',
        'viewresults': 'Voir les résultats',
        'availableexams': 'Examens disponibles',
        'viewall': 'Voir tout',
        'instructordashboard': 'Tableau de bord Instructeur',
        'createnewexam': 'Créer un nouvel examen',
        'totalexams': 'Total des examens',
        'pendinggrading': 'En attente de notation',
        'quickactions': 'Actions rapides',
        'uploadnewexam': 'Télécharger un nouvel examen',
        'viewallexams': 'Voir tous les examens',
        'viewallsubmissions': 'Voir toutes les soumissions',
        'testaigrading': 'Tester la notation IA',
        'recentexams': 'Examens récents',
        'examprocessed': 'Traité',
        'examquestions': 'Questions',
        'exampoints': 'Points',
        'noexamsuploaded': 'Aucun examen téléchargé',
        'uploadfirstexam': 'Télécharger le premier examen',
        'recentsubmissions': 'Soumissions récentes',
        'nosubmissions': 'Aucune soumission',
        'nosubmissionsmessage': 'Les étudiants apparaîtront ici une fois qu\'ils soumettront des examens',
        
        # Exam Management
        'exam_upload_title': 'Télécharger un nouvel examen',
        'exam_upload_file': 'Télécharger PDF/Fichier',
        'exam_upload_manual': 'Créer les questions manuellement',
        'exam_upload_submit': 'Télécharger l\'examen',
        'exam_upload_success': 'Examen téléchargé avec succès !',
        'exam_upload_error': 'Échec du téléchargement de l\'examen',
        'exam_list_title': 'Tous les examens',
        'exam_delete': 'Supprimer l\'examen',
        'exam_delete_confirm': 'Êtes-vous sûr de vouloir supprimer cet examen ?',
        'exam_delete_success': 'Examen supprimé avec succès',
        'exam_delete_error': 'Impossible de supprimer l\'examen avec des soumissions',
        'exam_view_submissions': 'Voir les soumissions',
        'exam_add_questions': 'Ajouter des questions manuellement',
        'exam_questions_detected': 'Questions détectées',
        'exam_processing_failed': 'Échec du traitement',
        
        # Question Management
        'question_text': 'Texte de la question',
        'question_points': 'Points',
        'question_type': 'Type de question',
        'question_add': 'Ajouter une question',
        'question_remove': 'Supprimer',
        'question_reorder': 'Réorganiser',
        'question_save': 'Enregistrer les questions',
        'question_save_success': 'Questions enregistrées avec succès',
        
        # Submission Management
        'submission_list_title': 'Soumissions',
        'submission_student': 'Étudiant',
        'submission_date': 'Date',
        'submission_score': 'Score',
        'submission_status': 'Statut',
        'submission_graded': 'Noté',
        'submission_pending': 'En attente',
        'submission_view': 'Voir',
        'submission_delete': 'Supprimer',
        'submission_delete_confirm': 'Supprimer cette soumission ?',
        'submission_reevaluate': 'Réévaluer',
        'submission_reevaluate_all': 'Réévaluer tout',
        'submission_delete_all': 'Tout supprimer',
        'submission_delete_all_confirm': 'Supprimer toutes les soumissions ?',
        
        # Grading
        'grading_title': 'Résultats de notation',
        'grading_question': 'Question',
        'grading_answer': 'Réponse de l\'étudiant',
        'grading_score': 'Score',
        'grading_feedback': 'Commentaires',
        'grading_total': 'Score total',
        'grading_ai_failed': 'Échec de la notation IA',
        'grading_basic_score': 'Note de base',
        'grading_processing': 'Traitement...',
        'grading_completed': 'Notation terminée !',
        
        # Student Interface
        'student_take_exam': 'Passer l\'examen',
        'student_submit_exam': 'Soumettre l\'examen',
        'student_answer_file': 'Fichier de réponses complet (Optionnel)',
        'student_answer_file_help': 'Téléchargez un fichier avec toutes vos réponses pour une meilleure détection',
        'student_submit_success': 'Examen soumis avec succès !',
        'student_submit_error': 'Échec de la soumission de l\'examen',
        'student_exam_completed': 'Examen terminé',
        'student_view_results': 'Voir les résultats',
        
        # Common UI Elements
        'btn_save': 'Enregistrer',
        'btn_cancel': 'Annuler',
        'btn_edit': 'Modifier',
        'btn_delete': 'Supprimer',
        'btn_view': 'Voir',
        'btn_back': 'Retour',
        'btn_next': 'Suivant',
        'btn_previous': 'Précédent',
        'btn_submit': 'Soumettre',
        'btn_upload': 'Télécharger',
        'btn_download': 'Télécharger',
        'btn_close': 'Fermer',
        
        # Messages
        'msg_success': 'Opération réussie',
        'msg_error': 'Une erreur s\'est produite',
        'msg_warning': 'Attention',
        'msg_info': 'Information',
        'msg_confirm': 'Êtes-vous sûr ?',
        'msg_loading': 'Chargement...',
        'msg_no_data': 'Aucune donnée disponible',
        'msg_users': 'Utilisateurs',
        'msg_system': 'Système',
        'msg_messages': 'Messages',
        
        # File Upload
        'file_upload_drag': 'Glissez et déposez les fichiers ici',
        'file_upload_click': 'ou cliquez pour parcourir',
        'file_upload_supported': 'Formats supportés : PDF, DOC, DOCX, TXT, Images',
        'file_upload_error': 'Format de fichier invalide',
        'file_upload_size_error': 'Fichier trop volumineux',
        
        # Language
        'language': 'Langue',
        'language_en': 'English',
        'language_fr': 'Français',
        'language_ar': 'العربية',
        'language_tr': 'Türkçe',
        
        # Footer
        'footer_copyright': '© 2024 SmartGrader. Tous droits réservés.',
        'footer_version': 'Version 1.0',
        'mark_all_as_read': 'Marquer tout comme lu',
        'new_message': 'Nouveau',
        # Messaging UI
        'compose_message_title': 'Composer un message',
        'back_to_messages': 'Retour aux messages',
        'to_label': 'À',
        'from_label': 'De',
        'subject_label': 'Objet',
        'message_label': 'Message',
        'enter_subject_placeholder': "Saisir l'objet...",
        'type_message_placeholder': 'Écrivez votre message ici...',
        'select_recipient_placeholder': 'Sélectionner un destinataire...',
        'select_recipient_help': 'Sélectionnez un utilisateur à qui envoyer votre message.',
        'send_message_button': 'Envoyer le message',
        'inbox_tab': 'Boîte de réception',
        'sent_tab': 'Envoyés',
        'no_subject': 'Sans objet',
        'no_messages_in_inbox': 'Aucun message dans la boîte de réception',
        'no_messages_in_inbox_desc': "Vous n'avez pas encore reçu de messages.",
        'no_sent_messages': 'Aucun message envoyé',
        'no_sent_messages_desc': "Vous n'avez pas encore envoyé de messages.",
        'view_message_title': 'Voir le message',
        'attachment_label': 'Pièce jointe',
        'read_status': 'Lu',
        'delivered_status': 'Distribué',
        'reply_button': 'Répondre',
        
        # Email Verification
        'verification_email_subject': 'SmartGrader - Vérification de réinitialisation du mot de passe',
        'verification_email_greeting': 'Bonjour,',
        'verification_email_body': 'Vous avez demandé à réinitialiser votre mot de passe pour votre compte SmartGrader. Veuillez utiliser le code de vérification ci-dessous pour compléter le processus de réinitialisation du mot de passe.',
        'verification_email_expiry': 'Ce code expirera dans 15 minutes.',
        'verification_email_link_text': 'Lien de réinitialisation du mot de passe',
        'verification_email_footer': 'Si vous n\'avez pas demandé cette réinitialisation de mot de passe, veuillez ignorer cet e-mail. La sécurité de votre compte est importante pour nous.',
        'verification_code_sent': 'Code de vérification envoyé à votre e-mail avec succès !',
        'email_send_error': 'Échec de l\'envoi de l\'e-mail de vérification. Veuillez réessayer.',
        'invalid_or_expired_code': 'Code de vérification invalide ou expiré.',
        'code_resent': 'Le code de vérification a été renvoyé à votre e-mail.',
        'password_updated_successfully': 'Mot de passe mis à jour avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.',
        'email_not_found': 'Adresse e-mail introuvable dans notre système.',
        'invalid_request': 'Demande invalide.',
        'invalid_or_expired_token': 'Jeton de réinitialisation invalide ou expiré.',
        'password_too_short': 'Le mot de passe doit contenir au moins 8 caractères.',
        'passwords_not_match': 'Les mots de passe ne correspondent pas.',
        'username_email_mismatch': 'Le nom d\'utilisateur ne correspond pas à l\'adresse e-mail fournie.',
        'moderator_request_sent': 'Demande de réinitialisation de mot de passe envoyée aux modérateurs avec succès.',
        'moderator_request_error': 'Échec de l\'envoi de la demande au modérateur. Veuillez réessayer.',
        'password_reset_request': 'Demande de réinitialisation de mot de passe',
        'password_reset_request_body': 'Un utilisateur a demandé une réinitialisation de mot de passe par l\'assistance d\'un modérateur.',
        'user_details': 'Détails de l\'utilisateur',
        'moderator_action_required': 'Veuillez aider cet utilisateur avec sa demande de réinitialisation de mot de passe.',
        
        # Change Password
        'new_password': 'Nouveau mot de passe',
        'new_password_subtitle': 'Définir votre nouveau mot de passe',
        'new_password_description': 'Entrez un mot de passe fort pour sécuriser votre compte',
        'set_new_password': 'Définir le nouveau mot de passe',
        'account_verified': 'Compte vérifié pour',
        'password_requirements': 'Le mot de passe doit contenir au moins 8 caractères',
        'confirm_new_password': 'Confirmer le nouveau mot de passe',
        'update_password': 'Mettre à jour le mot de passe'
    },
    
    'ar': {
        # Navigation
        'nav_home': 'الرئيسية',
        'nav_dashboard': 'لوحة التحكم',
        'nav_exams': 'الامتحانات',
        'nav_submissions': 'الواجبات المقدمة',
        'nav_logout': 'تسجيل الخروج',
        'nav_login': 'تسجيل الدخول',
        'nav_register': 'إنشاء حساب',
        'instructor_dashboard': 'لوحة تحكم المدرس',
        'student_dashboard': 'لوحة تحكم الطالب',
        'my_exams': 'امتحاناتي',
        'create_exam': 'إنشاء امتحان',
        'available_exams': 'الامتحانات المتاحة',
        'my_submissions': 'واجباتي المقدمة',
        'messages': 'الرسائل',
        'file_upload': 'رفع ملف',
        'logout': 'تسجيل الخروج',
        'dashboard': 'لوحة التحكم',
        'users': 'المستخدمون',
        'system': 'النظام',
        
        # Authentication
        'login_title': 'تسجيل الدخول إلى SmartGrader',
        'login_email': 'البريد الإلكتروني',
        'login_password': 'كلمة المرور',
        'login_submit': 'تسجيل الدخول',
        'login_error': 'البريد الإلكتروني أو كلمة المرور غير صحيحة',
        'register_title': 'إنشاء حساب',
        'register_name': 'الاسم الكامل',
        'register_email': 'البريد الإلكتروني',
        'register_password': 'كلمة المرور',
        'register_confirm_password': 'تأكيد كلمة المرور',
        'register_role': 'الدور',
        'register_instructor': 'مدرس',
        'register_student': 'طالب',
        'register_submit': 'إنشاء حساب',
        'register_success': 'تم إنشاء الحساب بنجاح!',
        'register_error': 'فشل في إنشاء الحساب. يرجى المحاولة مرة أخرى.',
        
        # Login and Registration UI
        'signup': 'إنشاء حساب',
        'incase_forgot_password': 'في حالة نسيان كلمة المرور',
        'click_here_to_reset': 'انقر هنا لإعادة تعيين',
        'create_your_account': 'إنشاء حسابك',
        'full_name_label': 'الاسم الكامل',
        'username_label': 'اسم المستخدم',
        'email_address_label': 'عنوان البريد الإلكتروني',
        'password_label': 'كلمة المرور',
        'confirm_password_label': 'تأكيد كلمة المرور',
        'preferred_language_label': 'اللغة المفضلة',
        'minimum_characters': 'الحد الأدنى 8 أحرف',
        'terms_agreement_text': 'أوافق على الشروط والأحكام',
        'create_account_button': 'إنشاء حساب',
        'error_changing_language': 'خطأ في تغيير اللغة: ',
        'error_changing_language_generic': 'خطأ في تغيير اللغة. يرجى المحاولة مرة أخرى.',
        'password_mismatch_validation': 'كلمات المرور غير متطابقة',
        'registration_success_alert': 'تم التسجيل بنجاح! يرجى التحقق من بريدك الإلكتروني.',
        'registration_failed_alert': 'فشل التسجيل: ',
        'registration_failed_generic': 'فشل التسجيل. يرجى المحاولة مرة أخرى.',
        
        # Password Reset
        'password_reset': 'إعادة تعيين كلمة المرور',
        'password_reset_subtitle': 'أعد تعيين كلمة المرور بأمان',
        'password_reset_description': 'اختر الطريقة المفضلة لديك لإعادة تعيين كلمة المرور',
        'forgot_password': 'نسيت كلمة المرور',
        'email_verification': 'التحقق عبر البريد الإلكتروني',
        'moderator_request': 'طلب من المشرف',
        'email_address': 'عنوان البريد الإلكتروني',
        'email_verification_help': 'أدخل عنوان بريدك الإلكتروني لاستلام رمز التحقق',
        'send_verification_code': 'إرسال رمز التحقق',
        'username': 'اسم المستخدم',
        'reset_reason': 'سبب إعادة التعيين',
        'reset_reason_placeholder': 'يرجى شرح سبب الحاجة لإعادة تعيين كلمة المرور...',
        'request_moderator_help': 'طلب مساعدة المشرف',
        'back_to_login': 'العودة لتسجيل الدخول',
        'code_sent_to': 'تم إرسال رمز التحقق إلى',
        'check_spam_folder': 'يرجى التحقق من مجلد الرسائل غير المرغوب فيها إذا لم تجده',
        'verification_code': 'رمز التحقق',
        'enter_6_digit_code': 'أدخل الرمز المكون من 6 أرقام المرسل إلى بريدك الإلكتروني',
        'verify_code': 'التحقق من الرمز',
        'didnt_receive_code': 'لم تستلم الرمز؟',
        'resend_code': 'إعادة إرسال الرمز',
        'back_to_reset': 'العودة لإعادة التعيين',
        
        # Dashboard
        'dashboard_welcome': 'مرحباً بك في SmartGrader',
        'dashboard_welcome_subtitle': 'مساعد التصحيح المدعوم بالذكاء الاصطناعي',
        'dashboard_recent_exams': 'الامتحانات الحديثة',
        'dashboard_recent_submissions': 'الواجبات المقدمة حديثاً',
        'dashboard_view_all': 'عرض الكل',
        'dashboard_no_exams': 'لا توجد امتحانات مرفوعة',
        'dashboard_no_submissions': 'لا توجد واجبات مقدمة',
        'dashboard_total_exams': 'إجمالي الامتحانات',
        'dashboard_total_submissions': 'إجمالي الواجبات المقدمة',
        'dashboard_avg_score': 'متوسط الدرجات',
        'totalsubmissions': 'إجمالي الواجبات المقدمة',
        'graded': 'تم التصحيح',
        'pending': 'في الانتظار',
        'averagescore': 'متوسط الدرجات',
        'quickactions': 'إجراءات سريعة',
        'viewavailableexams': 'عرض الامتحانات المتاحة',
        'mysubmissions': 'واجباتي المقدمة',
        'viewresults': 'عرض النتائج',
        'availableexams': 'الامتحانات المتاحة',
        'viewall': 'عرض الكل',
        'instructordashboard': 'لوحة تحكم المدرس',
        'createnewexam': 'إنشاء امتحان جديد',
        'totalexams': 'إجمالي الامتحانات',
        'pendinggrading': 'في انتظار التصحيح',
        'quickactions': 'إجراءات سريعة',
        'uploadnewexam': 'رفع امتحان جديد',
        'viewallexams': 'عرض جميع الامتحانات',
        'viewallsubmissions': 'عرض جميع الواجبات المقدمة',
        'testaigrading': 'اختبار التصحيح بالذكاء الاصطناعي',
        'recentexams': 'الامتحانات الحديثة',
        'examprocessed': 'تمت المعالجة',
        'examquestions': 'أسئلة',
        'exampoints': 'نقاط',
        'noexamsuploaded': 'لا توجد امتحانات مرفوعة',
        'uploadfirstexam': 'رفع أول امتحان',
        'recentsubmissions': 'الواجبات المقدمة حديثاً',
        'nosubmissions': 'لا توجد واجبات مقدمة',
        'nosubmissionsmessage': 'سيظهر الطلاب هنا بمجرد تقديمهم للامتحانات',
        
        # Exam Management
        'exam_upload_title': 'رفع امتحان جديد',
        'exam_upload_file': 'رفع ملف PDF/ملف',
        'exam_upload_manual': 'إنشاء الأسئلة يدوياً',
        'exam_upload_submit': 'رفع الامتحان',
        'exam_upload_success': 'تم رفع الامتحان بنجاح!',
        'exam_upload_error': 'فشل في رفع الامتحان',
        'exam_list_title': 'جميع الامتحانات',
        'exam_delete': 'حذف الامتحان',
        'exam_delete_confirm': 'هل أنت متأكد من حذف هذا الامتحان؟',
        'exam_delete_success': 'تم حذف الامتحان بنجاح',
        'exam_delete_error': 'لا يمكن حذف الامتحان مع وجود واجبات مقدمة',
        'exam_view_submissions': 'عرض الواجبات المقدمة',
        'exam_add_questions': 'إضافة أسئلة يدوياً',
        'exam_questions_detected': 'تم اكتشاف الأسئلة',
        'exam_processing_failed': 'فشل في المعالجة',
        
        # Question Management
        'question_text': 'نص السؤال',
        'question_points': 'النقاط',
        'question_type': 'نوع السؤال',
        'question_add': 'إضافة سؤال',
        'question_remove': 'حذف',
        'question_reorder': 'إعادة ترتيب',
        'question_save': 'حفظ الأسئلة',
        'question_save_success': 'تم حفظ الأسئلة بنجاح',
        
        # Submission Management
        'submission_list_title': 'الواجبات المقدمة',
        'submission_student': 'الطالب',
        'submission_date': 'التاريخ',
        'submission_score': 'الدرجة',
        'submission_status': 'الحالة',
        'submission_graded': 'تم التصحيح',
        'submission_pending': 'في الانتظار',
        'submission_view': 'عرض',
        'submission_delete': 'حذف',
        'submission_delete_confirm': 'حذف هذه الواجبة المقدمة؟',
        'submission_reevaluate': 'إعادة تقييم',
        'submission_reevaluate_all': 'إعادة تقييم الكل',
        'submission_delete_all': 'حذف الكل',
        'submission_delete_all_confirm': 'حذف جميع الواجبات المقدمة؟',
        
        # Grading
        'grading_title': 'نتائج التصحيح',
        'grading_question': 'السؤال',
        'grading_answer': 'إجابة الطالب',
        'grading_score': 'الدرجة',
        'grading_feedback': 'التعليقات',
        'grading_total': 'الدرجة الإجمالية',
        'grading_ai_failed': 'فشل التصحيح بالذكاء الاصطناعي',
        'grading_basic_score': 'الدرجة الأساسية',
        'grading_processing': 'جاري المعالجة...',
        'grading_completed': 'تم التصحيح!',
        
        # Student Interface
        'student_take_exam': 'أداء الامتحان',
        'student_submit_exam': 'تقديم الامتحان',
        'student_answer_file': 'ملف الإجابات الكامل (اختياري)',
        'student_answer_file_help': 'ارفع ملفاً يحتوي على جميع إجاباتك للحصول على اكتشاف أفضل',
        'student_submit_success': 'تم تقديم الامتحان بنجاح!',
        'student_submit_error': 'فشل في تقديم الامتحان',
        'student_exam_completed': 'تم الانتهاء من الامتحان',
        'student_view_results': 'عرض النتائج',
        'back_to_dashboard': 'العودة لللوحة التحكم',
        'exam_questions_header': 'أسئلة الامتحان',
        'question_label': 'السؤال',
        'points_label': 'النقاط',
        'your_answer_label': 'إجابتك',
        'type_answer_placeholder': 'اكتب إجابتك هنا...',
        'upload_file_optional': 'رفع ملف (اختياري):',
        'upload_file_help': 'رفع ملفات PDF أو صور أو مستندات. سيقوم الذكاء الاصطناعي بتحليل العمل اليدوي والصور.',
        'complete_answer_file_optional': 'ملف الإجابات الكامل (اختياري)',
        'upload_complete_answer_label': 'رفع ملف الإجابات الكامل:',
        'save_progress': 'حفظ التقدم',
        'no_questions_available': 'لا توجد أسئلة متاحة',
        'no_questions_yet': "هذا الامتحان لا يحتوي على أي أسئلة بعد.",
        'exam_information': 'معلومات الامتحان',
        'exam_label': 'الامتحان',
        'general_label': 'عام',
        'questions_label': 'الأسئلة',
        'total_points_label': 'النقاط الكلية',
        'time_limit_label': 'حد الوقت',
        'no_time_limit': 'لا حد للوقت',
        'progress_label': 'التقدم',
        'confirm_submission': 'تأكيد التقديم',
        'confirm_submit_exam': 'هل أنت متأكد من تقديم هذا الامتحان؟',
        'submit_final_notice': 'بمجرد التقديم، لا يمكنك تغيير إجاباتك.',
        
        # Common UI Elements
        'btn_save': 'حفظ',
        'btn_cancel': 'إلغاء',
        'btn_edit': 'تعديل',
        'btn_delete': 'حذف',
        'btn_view': 'عرض',
        'btn_back': 'رجوع',
        'btn_next': 'التالي',
        'btn_previous': 'السابق',
        'btn_submit': 'تقديم',
        'btn_upload': 'رفع',
        'btn_download': 'تحميل',
        'btn_close': 'إغلاق',
        
        # Messages
        'msg_success': 'تمت العملية بنجاح',
        'msg_error': 'حدث خطأ',
        'msg_warning': 'تحذير',
        'msg_info': 'معلومات',
        'msg_confirm': 'هل أنت متأكد؟',
        'msg_loading': 'جاري التحميل...',
        'msg_no_data': 'لا توجد بيانات متاحة',
        'msg_users': 'المستخدمون',
        'msg_system': 'النظام',
        'msg_messages': 'الرسائل',
        
        # File Upload
        'file_upload_drag': 'اسحب وأفلت الملفات هنا',
        'file_upload_click': 'أو انقر للتصفح',
        'file_upload_supported': 'الصيغ المدعومة: PDF, DOC, DOCX, TXT, الصور',
        'file_upload_error': 'صيغة ملف غير صحيحة',
        'file_upload_size_error': 'الملف كبير جداً',
        
        # Language
        'language': 'اللغة',
        'language_en': 'English',
        'language_fr': 'Français',
        'language_ar': 'العربية',
        'language_tr': 'Türkçe',
        
        # Footer
        'footer_copyright': '© 2024 SmartGrader. جميع الحقوق محفوظة.',
        'footer_version': 'الإصدار 1.0',
        'mark_all_as_read': 'تحديد الكل كمقروء',
        'new_message': 'جديد',
        # Messaging UI
        'compose_message_title': 'إنشاء رسالة',
        'back_to_messages': 'العودة إلى الرسائل',
        'to_label': 'إلى',
        'from_label': 'من',
        'subject_label': 'الموضوع',
        'message_label': 'الرسالة',
        'enter_subject_placeholder': 'أدخل الموضوع...',
        'type_message_placeholder': 'اكتب رسالتك هنا...',
        'select_recipient_placeholder': 'اختر المستلم...',
        'select_recipient_help': 'اختر مستخدماً لإرسال رسالتك إليه.',
        'send_message_button': 'إرسال الرسالة',
        'inbox_tab': 'الوارد',
        'sent_tab': 'المرسلة',
        'no_subject': 'بدون موضوع',
        'no_messages_in_inbox': 'لا توجد رسائل في الوارد',
        'no_messages_in_inbox_desc': 'لم تستلم أي رسائل بعد.',
        'no_sent_messages': 'لا توجد رسائل مرسلة',
        'no_sent_messages_desc': 'لم تقم بإرسال أي رسائل بعد.',
        'view_message_title': 'عرض الرسالة',
        'attachment_label': 'مرفق',
        'read_status': 'مقروء',
        'delivered_status': 'تم التسليم',
        'reply_button': 'رد',
        
        # Email Verification
        'verification_email_subject': 'SmartGrader - التحقق من إعادة تعيين كلمة المرور',
        'verification_email_greeting': 'مرحباً،',
        'verification_email_body': 'لقد طلبت إعادة تعيين كلمة المرور لحسابك في SmartGrader. يرجى استخدام رمز التحقق أدناه لإكمال عملية إعادة تعيين كلمة المرور.',
        'verification_email_expiry': 'سينتهي هذا الرمز خلال 15 دقيقة.',
        'verification_email_link_text': 'رابط إعادة تعيين كلمة المرور',
        'verification_email_footer': 'إذا لم تطلب إعادة تعيين كلمة المرور هذه، يرجى تجاهل هذا البريد الإلكتروني. أمان حسابك مهم بالنسبة لنا.',
        'verification_code_sent': 'تم إرسال رمز التحقق إلى بريدك الإلكتروني بنجاح!',
        'email_send_error': 'فشل في إرسال بريد التحقق الإلكتروني. يرجى المحاولة مرة أخرى.',
        'invalid_or_expired_code': 'رمز التحقق غير صحيح أو منتهي الصلاحية.',
        'code_resent': 'تم إعادة إرسال رمز التحقق إلى بريدك الإلكتروني.',
        'password_updated_successfully': 'تم تحديث كلمة المرور بنجاح! يمكنك الآن تسجيل الدخول بكلمة المرور الجديدة.',
        'email_not_found': 'عنوان البريد الإلكتروني غير موجود في نظامنا.',
        'invalid_request': 'طلب غير صحيح.',
        'invalid_or_expired_token': 'رمز إعادة التعيين غير صحيح أو منتهي الصلاحية.',
        'password_too_short': 'يجب أن تكون كلمة المرور 8 أحرف على الأقل.',
        'passwords_not_match': 'كلمات المرور غير متطابقة.',
        'username_email_mismatch': 'اسم المستخدم لا يتطابق مع عنوان البريد الإلكتروني المقدم.',
        'moderator_request_sent': 'تم إرسال طلب إعادة تعيين كلمة المرور إلى المشرفين بنجاح.',
        'moderator_request_error': 'فشل في إرسال طلب المشرف. يرجى المحاولة مرة أخرى.',
        'password_reset_request': 'طلب إعادة تعيين كلمة المرور',
        'password_reset_request_body': 'طلب مستخدم إعادة تعيين كلمة المرور من خلال مساعدة المشرف.',
        'user_details': 'تفاصيل المستخدم',
        'moderator_action_required': 'يرجى مساعدة هذا المستخدم في طلب إعادة تعيين كلمة المرور.',
        
        # Change Password
        'new_password': 'كلمة مرور جديدة',
        'new_password_subtitle': 'تعيين كلمة المرور الجديدة',
        'new_password_description': 'أدخل كلمة مرور قوية لتأمين حسابك',
        'set_new_password': 'تعيين كلمة المرور الجديدة',
        'account_verified': 'تم التحقق من الحساب لـ',
        'password_requirements': 'يجب أن تكون كلمة المرور 8 أحرف على الأقل',
        'confirm_new_password': 'تأكيد كلمة المرور الجديدة',
        'update_password': 'تحديث كلمة المرور',
        
        # Login/Logout Messages
        'login_successful': 'Giriş başarılı!',
        'logout_successful': 'Çıkış başarılı!',
        'invalid_credentials': 'Geçersiz e-posta veya şifre',
        
        # Security Question System
        'security_question': 'Security Question',
        'security_answer': 'Security Answer',
        'select_security_question': 'Select a Security Question',
        'enter_security_answer': 'Enter Your Answer',
        'security_question_required': 'Please select a security question and provide an answer',
        'security_answer_required': 'Please provide an answer to your security question',
        'security_question_incorrect': 'Incorrect security answer. Please try again.',
        'security_question_success': 'Security answer verified successfully!',
        'password_reset_via_security_question': 'Password Reset via Security Question',
        'answer_security_question': 'Answer Your Security Question',
        'security_question_help': 'This will be used to reset your password if you forget it',
        
        # Additional Security Question Keys
        'email_not_found': 'Email non trouvé',
        'invalid_request': 'Demande invalide',
        'password_updated_successfully': 'Mot de passe mis à jour avec succès !',
        'passwords_not_match': 'Les mots de passe ne correspondent pas'
    }
}

def get_language():
    """Get current language from session or request"""
    if 'language' in session:
        return session['language']
    
    # Try to get from request headers
    accept_language = request.headers.get('Accept-Language', '')
    if accept_language:
        # Parse Accept-Language header
        for lang in accept_language.split(','):
            lang = lang.split(';')[0].strip()
            if lang in LANGUAGES:
                return lang
            # Check for language without region (e.g., 'en' from 'en-US')
            lang_base = lang.split('-')[0]
            if lang_base in LANGUAGES:
                return lang_base
    
    return 'en'  # Default to English

def set_language(lang):
    """Set language in session"""
    if lang in LANGUAGES:
        session['language'] = lang

def get_text(key, lang=None):
    """Get translated text for a key"""
    if lang is None:
        lang = get_language()
    
    if lang not in TRANSLATIONS:
        lang = 'en'  # Fallback to English
    
    return TRANSLATIONS[lang].get(key, TRANSLATIONS['en'].get(key, key))

def get_languages():
    """Get available languages"""
    return LANGUAGES

# Context processor for templates
def init_app(app):
    """Initialize the translation system with Flask app"""
    @app.context_processor
    def inject_translations():
        return {
            'get_text': get_text,
            'get_language': get_language,
            'get_languages': get_languages,
            'LANGUAGES': LANGUAGES
        }
