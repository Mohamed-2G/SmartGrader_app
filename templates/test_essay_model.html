{% extends "base.html" %}

{% block title %}Test AI Grading System{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header">
                    <h3>üß™ Test AI Grading System</h3>
                    <p class="text-muted">Test the DeepSeek AI-powered grading system with your own text</p>
                </div>
                <div class="card-body">
                    <form id="testGradingForm">
                        <div class="mb-3">
                            <label for="testText" class="form-label">Text to Test:</label>
                            <textarea class="form-control" id="testText" rows="8" placeholder="Enter your text here...">The importance of education cannot be overstated in today's rapidly evolving world. Education serves as the foundation for personal growth, career development, and societal progress. It equips individuals with critical thinking skills, knowledge, and the ability to adapt to changing circumstances. Furthermore, education promotes social mobility and helps reduce inequality by providing equal opportunities for all individuals regardless of their background. In the digital age, education has become even more crucial as it prepares students for jobs that may not even exist yet. Therefore, investing in quality education is essential for building a better future for individuals and society as a whole.</textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="maxPoints" class="form-label">Maximum Points:</label>
                            <input type="number" class="form-control" id="maxPoints" value="20" min="1" max="100">
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <span id="submitText">Test AI Grading</span>
                            <span id="loadingText" style="display: none;">
                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                Testing...
                            </span>
                        </button>
                    </form>
                    
                    <div id="resultSection" style="display: none;" class="mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>üìä Grading Results</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Score:</h6>
                                        <div class="alert alert-info">
                                            <span id="scoreResult">-</span> / <span id="maxPointsResult">-</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Model Used:</h6>
                                        <div class="alert alert-success">
                                            <span id="modelUsed">-</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <h6>Feedback:</h6>
                                    <div class="alert alert-light">
                                        <span id="feedbackResult">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="errorSection" style="display: none;" class="mt-4">
                        <div class="alert alert-danger">
                            <h6>Error:</h6>
                            <span id="errorMessage">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5>üìù Sample Texts for Testing</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Sample 1: Short Essay</h6>
                            <button class="btn btn-outline-secondary btn-sm mb-2" onclick="loadSample1()">Load Sample</button>
                            <p class="text-muted small">A brief essay about technology's impact on society.</p>
                        </div>
                        <div class="col-md-6">
                            <h6>Sample 2: Long Essay</h6>
                            <button class="btn btn-outline-secondary btn-sm mb-2" onclick="loadSample2()">Load Sample</button>
                            <p class="text-muted small">A comprehensive essay about climate change and solutions.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('testGradingForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const testText = document.getElementById('testText').value;
    const maxPoints = document.getElementById('maxPoints').value;
    
    if (!testText.trim()) {
        alert('Please enter some text to test.');
        return;
    }
    
    // Show loading state
    document.getElementById('submitText').style.display = 'none';
    document.getElementById('loadingText').style.display = 'inline';
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('errorSection').style.display = 'none';
    
    // Make API call
    fetch('/api/test_grading', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            text: testText,
            max_points: parseInt(maxPoints)
        })
    })
    .then(response => response.json())
    .then(data => {
        // Hide loading state
        document.getElementById('submitText').style.display = 'inline';
        document.getElementById('loadingText').style.display = 'none';
        
        if (data.success) {
            // Show results
            document.getElementById('scoreResult').textContent = data.score;
            document.getElementById('maxPointsResult').textContent = data.max_points;
            document.getElementById('modelUsed').textContent = data.model_used;
            document.getElementById('feedbackResult').textContent = data.feedback;
            document.getElementById('resultSection').style.display = 'block';
        } else {
            // Show error
            document.getElementById('errorMessage').textContent = data.error;
            document.getElementById('errorSection').style.display = 'block';
        }
    })
    .catch(error => {
        // Hide loading state
        document.getElementById('submitText').style.display = 'inline';
        document.getElementById('loadingText').style.display = 'none';
        
        // Show error
        document.getElementById('errorMessage').textContent = 'Network error: ' + error.message;
        document.getElementById('errorSection').style.display = 'block';
    });
});

function loadSample1() {
    document.getElementById('testText').value = `Technology has fundamentally transformed the way we live and work. The internet has made information accessible to billions of people worldwide, while smartphones have revolutionized communication. However, this rapid technological advancement also brings challenges such as digital addiction and privacy concerns. It is crucial to find a balance between embracing technology's benefits and addressing its potential drawbacks.`;
    document.getElementById('maxPoints').value = '15';
}

function loadSample2() {
    document.getElementById('testText').value = `Climate change represents one of the most pressing challenges facing humanity in the 21st century. The scientific consensus is clear: human activities, particularly the burning of fossil fuels, have significantly contributed to global warming. The consequences are already visible in rising sea levels, extreme weather events, and biodiversity loss. To address this crisis, we must implement comprehensive solutions including renewable energy adoption, sustainable agriculture practices, and international cooperation on emissions reduction. Individual actions such as reducing carbon footprints and supporting green policies are also essential. The transition to a sustainable future requires both technological innovation and behavioral change. While the challenge is immense, the cost of inaction far exceeds the investment needed for meaningful solutions.`;
    document.getElementById('maxPoints').value = '25';
}
</script>
{% endblock %}

